
# 💼 CUSTOMER RETENTION
![LOGO](https://miro.medium.com/v2/resize:fit:1024/1*WZdoYPpmiIk1AcPQ1YHWug.png)
# Описание проекта

Проект предназначен для решения задачи предсказания оттока клиентов на основе данных из учебного соревнования Kaggle. 

Основная цель — создать модель машинного обучения, которая способна прогнозировать вероятность ухода клиента, что помогает бизнесу принимать своевременные меры для удержания.
 
Официальной метрикой соревнования выступала ROC AUC, которая использовалась для выбора и оценки моделей. Однако для практического применения важно не только качество ранжирования, но и способность модели предсказывать факт оттока. Поэтому дополнительно была рассчитана Fβ-мера с β = 2 на валидационной выборке, и по ней выбран оптимальный порог вероятности, чтобы повысить чувствительность модели (recall) и минимизировать риск упустить клиента, склонного к уходу.

В рамках проекта реализован полный pipeline: от предварительного анализа и обработки данных, через обучение и оценку моделей, до развертывания REST API для получения предсказаний и интеграции с базой данных. Кроме того, обеспечено модульное тестирование ключевых компонентов для повышения надёжности системы.
# Реализовано
- ✅ **[EDA](notebooks/EDA.ipynb)** в Jupyter: выявление дубликатов, выбросов и дисбаланс класов, построение графиков распределения признаков
- ✅ Обучение моделей с оптимизацией ROC AUC (официальная метрика соревнования)
- ✅ Оптимизация порога вероятности на отложенной выборке по Fβ-мере (β = 2)
- ✅ Обучение и сравнение **[моделей](notebooks/main_model.ipynb)** в Jupyter: CatBoostClassifier, XGBClassifier, Ensemble 
- ✅ Сохранение лучшей **[модели](model/best_model.pkl)**
- ✅ Модули для **[предобработки](src/ML/preprocessing.py)** данных и **[предсказания](src/ML/predictor.py)** на основе сохранённой модели
- ✅ Реализация REST API с FastAPI: **[точка входа](src/api/main.py)**, **[маршруты](src/api/routes.py)** и обработка POST-запросов 
- ✅ Полная настройка Docker для запуска API и базы данных в изолированной среде
- ✅ **[Юнит-тесты](tests/unit)** для проверки корректности работы модулей предобработки и предсказания, а также фикстуры для тестов.
# Технологии и инструменты

- 🐍 Python  
- 📊 Pandas  
- 🔍 scikit-learn  
- 💻 Jupyter Notebook  
- 🐱‍🏍 CatBoost  
- ⚡ XGBoost  
- 🚀 FastAPI  
- 🐘 PostgreSQL  
- 🐳 Docker & Docker Compose  
- 🧪 Pytest  
- 📦 pickle  
- 🛠️ Git
# 📁 Структура проекта
```

├── data                      # Исходные и обработанные данные для обучения и валидации
│   ├── processed
│   │   ├── data_train.csv    # Обработанные обучающие данные
│   │   └── val_train.csv     # Обработочные данные для валидации
│   ├── raw
│   │   └── train.csv         # Сырой датасет из соревнования
|   ├── test
|   |    └── test.csv         # Сырой датасет из соревнования
│   ├── sample_submission.csv # Шаблон для сабмита
│   └── train.csv.zip         # Архив исходных данных
├── docker-compose.yml        # Конфигурация Docker Compose для запуска сервисов
├── Dockerfile                # Инструкция по сборке Docker образа
├── models                    # Сохранённые обученные модели
│   └── best_model.pkl        # Лучшая модель после обучения
|   └── best_treshold.json    # Лучший порог предсказания
├── notebooks                 # Jupyter ноутбуки с анализом и обучением моделей
│   ├── EDA.ipynb             # Исследовательский анализ данных
│   ├── main_model.ipynb      # Обучение и сравнение моделей
│   ├── models.ipynb          # Исследование моделей
│   └── README.md             # Описание содержимого ноутбуков
├── processed                 # (пустая или для дополнительных обработанных данных)
├── requirements.txt          # Зависимости Python проекта
└── src                       # Исходный код проекта
    ├── api                  # Реализация REST API на FastAPI
    │   ├── main.py          # Точка входа API приложения
    │   └── routes.py        # Обработчики HTTP-запросов
    ├── database             # Работа с базой данных
    │   ├── connection.py    # Подключение к базе данных
    │   ├── crud.py          # Операции CRUD с данными
    │   ├── init.sql         # Скрипт инициализации базы
    │   └── tables.py        # Описание таблиц базы данных
    ├── ML                   # Модули машинного обучения
    │   ├── predictor.py     # Логика предсказания на основе модели
    │   └── preprocessing.py # Предобработка данных перед обучением и предсказанием
    └── tests                # Тесты проекта
        ├── fixtures.py      # Фикстуры для тестов (подготовка данных)
        └── unit             # Юнит-тесты для ключевых модулей
            ├── test_predictor.py      # Тесты для модуля предсказания
            └── test_preprocessing.py  # Тесты для модуля предобработки

```
# Инструкиця запуска
**ПРЕДВАРИТЕЛЬНЫЕ ТРЕБОВАНИЯ**
- Установлен Docker: https://docs.docker.com/engine/install/

**1. Клонируйте репозиторий и перейдите в папку проекта:**
```bash
git clone https://github.com/Naraqqq/client_retention_prediction
cd client_retention_prediction
```
**2.  Убедитесь, что в папке [data/raw/](data/raw) находится файл train.csv (исходные данные)**

**3.  Запустите проект через Docker Compose:**
```bash
docker-compose up --build
```
**4. Проверьте работу API в SwaggerUI**
- http://localhost:8000/docs
- customerid можете найти в тестовом [файле](data/test), который нужно открыть или через excel, или через pandas
